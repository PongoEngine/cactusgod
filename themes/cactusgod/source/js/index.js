(function(J){function O(a,b){var c=Object.create(a),e;for(e in b)c[e]=b[e];b.toString!==Object.prototype.toString&&(c.toString=b.toString);return c}J=function(){return C.__string_rec(this,"")};var P=P||{},A=function(){};A.__name__=!0;A.main=function(){var a=window.document.getElementById("app"),b=window.document.createElement("canvas");b.width=1200;b.height=600;a.appendChild(b);var c=new p(239);D.load([x.createGradient("enemy",100,0,0,20,120,60,10,c),x.createGradient("player",60,60,72,20,60,60,10,
c),x.createGradient("eyes",255,255,255,40,5,5,5,c)]).then(function(e){var d=new n(b,new Q(c)),f={children:[]},g=new h;f[g.name]=g;g=new K;f[g.name]=g;var k=f;d.state.setBackground(k);f=d.root;g=new B(d.state.simplex,1200,600,4);f[g.name]=g;f.children.push(k);e=A.createPlayer(new G,e.getImage("player"),e.getImage("eyes"),d.state.simplex(),0,0);k.children.push(e);for(var l=0;30>l;)++l,f={children:[]},g=(new y(255,255,255,1,20,10)).setAnchor(10,5),f[g.name]=g,g=new u(1),f[g.name]=g,g=new v(e),f[g.name]=
g,k.children.push(f);f=new R;d._systems.push(f);d._systems.push(new H);d._systems.push(new m);d._systems.push(new q);d._systems.push(new S)})};A.createPlayer=function(a,b,c,e,d,f){e={children:[]};b=(new E(b)).centerAnchor().setXY(d*A.TILE_WIDTH,f*A.TILE_WIDTH);e[b.name]=b;e[a.name]=a;b=new u(0);e[b.name]=b;a={children:[]};b=(new E(c)).setXY(6,15).centerAnchor();a[b.name]=b;e.children.push(a);a={children:[]};b=(new E(c)).setXY(15,15).centerAnchor();a[b.name]=b;e.children.push(a);return e};Math.__name__=
!0;var D=function(a){this._images=a};D.__name__=!0;D.load=function(a){var b=new T,c=0;return new Promise(function(e,d){for(var f=0;f<a.length;){var g=a[f];++f;var k=g.width,l=g.height,t=function(r){return function(F){b.h[r[0]]=F;(c+=1)==a.length&&e(new D(b))}}([g.name]);D.createImage(k,l,g.draw,t)}})};D.createImage=function(a,b,c,e){var d=window.document.createElement("canvas");d.width=a;d.height=b;var f=d.getContext("2d",null);c(f);c=d.toDataURL();d=window.document.createElement("img");d.onload=
function(g){e(g.target)};d.src=c;d.width=a;d.height=b};D.prototype={getImage:function(a){return this._images.h[a]}};var n=function(a,b){this._offsetX=0;this._scale=1;this._shouldUpdate=this._canUpdate=!1;var c=this;this._canvas=a;var e={children:[]};this.root=e;this._systems=[];var d=!1;this.state=b;this._canUpdate=!window.document.hidden;a.onclick=function(){d||(d=!0)};var f=e=a.getContext("2d",null),g=0;window.document.addEventListener("visibilitychange",function(l){window.document.hidden?(c._canUpdate=
!1,c._shouldUpdate=!1):c._canUpdate=!0});window.addEventListener("resize",function(l){c.onResize()});this.onResize();var k=null;k=function(l){if(c._canUpdate){f.clearRect(0,0,c._canvas.width,c._canvas.height);var t=.001*(l-g);g=l;c._shouldUpdate&&(f.save(),f.translate(c._offsetX,0),f.scale(c._scale,c._scale),n.update(c,c.root,f,t,c._systems),f.restore());c._shouldUpdate=!0;window.requestAnimationFrame(k)}};window.requestAnimationFrame(k)};n.__name__=!0;n.addToGroup=function(a,b,c){b(a)&&c.push(a);
var e=0;for(a=a.children;e<a.length;){var d=a[e];++e;n.addToGroup(d,b,c)}};n.iterateOnGroup=function(a,b,c){if(!b(a)||!c(a)){var e=0;for(a=a.children;e<a.length;){var d=a[e];++e;n.iterateOnGroup(d,b,c)}}};n.update=function(a,b,c,e,d){c.save();for(var f=0;f<d.length;){var g=d[f];++f;g.shouldUpdate(b)&&g.logic(a,b,e)}f=b[h._n];null!=f&&(c.translate(f.x,f.y),I.rotate(c,f.angle),c.scale(f.scaleX,f.scaleY),c.translate(-f.anchorX,-f.anchorY),I.setBlendMode(c,f.blendmode),f.draw(c,e));f=0;for(b=b.children;f<
b.length;)g=b[f],++f,n.update(a,g,c,e,d);c.restore()};n.prototype={getGroup:function(a){var b=[];n.addToGroup(this.root,a,b);return b},onResize:function(){var a=window.innerWidth,b=window.innerHeight;this._canvas.width=a;this._canvas.height=b;this._scale=b/600;this._offsetX=(a-1200*this._scale)/2}};var I={setColor:function(a,b,c,e,d){a.fillStyle="rgb("+b+","+c+","+e+","+d+")"},rotate:function(a,b){a.rotate(b)},setBlendMode:function(a,b){a.globalCompositeOperation=b}},h=function(){this.name="3";this.blendmode=
null;this.angle=0;this.scaleX=this.scaleY=1;this.x=this.y=this.lastX=this.lastY=this.anchorX=this.anchorY=0};h.__name__=!0;h.prototype={draw:function(a,b){},setAnchor:function(a,b){this.anchorX=a;this.anchorY=b;return this},setXY:function(a,b){this.set_x(a);this.set_y(b);return this},centerAnchor:function(){this.anchorX=this.naturalWidth()/2;this.anchorY=this.naturalHeight()/2;return this},left:function(a){null==a&&(a=this.x);return a-this.anchorX},right:function(a){return this.left(a)+this.naturalWidth()},
top:function(a){null==a&&(a=this.y);return a-this.anchorY},bottom:function(a){return this.top(a)+this.naturalHeight()},naturalWidth:function(){return 0},naturalHeight:function(){return 0},set_x:function(a){this.lastX=this.x;return this.x=a},set_y:function(a){this.lastY=this.y;return this.y=a}};var y=function(a,b,c,e,d,f){h.call(this);this.r=a;this.g=b;this.b=c;this.a=e;this.width=d;this.height=f};y.__name__=!0;y.__super__=h;y.prototype=O(h.prototype,{draw:function(a,b){I.setColor(a,this.r,this.g,
this.b,this.a);a.fillRect(0,0,this.width,this.height)},naturalWidth:function(){return this.width},naturalHeight:function(){return this.height}});var E=function(a){this.image=null;h.call(this);this.image=a};E.__name__=!0;E.__super__=h;E.prototype=O(h.prototype,{draw:function(a,b){null!=this.image&&a.drawImage(this.image,0,0)},naturalWidth:function(){return null==this.image?0:this.image.width},naturalHeight:function(){return null==this.image?0:this.image.height}});var w=function(){};w.__name__=!0;w.angle=
function(a,b,c,e){return Math.atan2(e-b,c-a)};w.cubeOut=function(a){return 1+--a*a*a};w.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};w.sign=function(a){return 0>a?-1:0<a?1:0};var p=function(a){this._p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,
230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,
106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];this._grad3=[{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:-1},{x:1,y:0},{x:-1,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1},{x:0,y:1},{x:0,y:-1}];this._perm=[];this._gradP=[];this.init(a)};p.__name__=!0;p.prototype={get:function(a,b){var c=(a+b)*p.F2;var e=Math.floor(a+c),d=Math.floor(b+c);c=(e+d)*p.G2;var f=a-e+c;var g=b-d+c;if(f>g){var k=1;var l=0}else k=0,l=1;var t=f-k+p.G2;var r=
g-l+p.G2;c=f-1+2*p.G2;var F=g-1+2*p.G2;e&=255;d&=255;var L=this._gradP[e+this._perm[d]];k=this._gradP[e+k+this._perm[d+l]];e=this._gradP[e+1+this._perm[d+1]];d=.5-f*f-g*g;0>d?f=0:(d*=d,f=d*d*(L.x*f+L.y*g));g=.5-t*t-r*r;0>g?t=0:(g*=g,t=g*g*(k.x*t+k.y*r));r=.5-c*c-F*F;0>r?c=0:(r*=r,c=r*r*(e.x*c+e.y*F));return 70*(f+t+c)},init:function(a){0<a&&1>a&&(a*=65536);a=Math.floor(a);256>a&&(a|=a<<8);for(var b=0;256>b;){var c=b++;var e=0!=(c&1)?this._p[c]^a&255:this._p[c]^a>>8&255;var d=this._perm[c+256]=e;this._perm[c]=
d;e=this._gradP[c+256]=this._grad3[e%12];this._gradP[c]=e}}};var Q=function(a){var b=this;this._simplex=a;this.simplex=function(){return b._simplex};this.background=function(){return b._background}};Q.__name__=!0;Q.prototype={setBackground:function(a){this._background=a}};var G=function(){this.name="4";this.isShiftedLeft=!1};G.__name__=!0;var S=function(){};S.__name__=!0;S.prototype={shouldUpdate:function(a){return a[B._n]?null!=a[B._n].setSimpXY:!1},logic:function(a,b,c){n.iterateOnGroup(a.root,
function(e){return e[K._n]?e[h._n]:!1},function(e){e=e[h._n];b[B._n].setSimpXY(e.x,e.y);return!0})}};var v=function(a){this.name="0";this._attractor=a;a=this._attractor[h._n];this.x=a.x+a.anchorX;this.y=a.y+a.anchorY;this.veloY=this.veloX=this.angle=0;this._target={x:this.x,y:this.y}};v.__name__=!0;v.prototype={get_target:function(){var a=this._attractor[h._n];if(this._attractor[u._n]){var b=this._attractor[u._n];this._target.x=a.x+(b.isLeft?-40:b.isRight?40:0);b=b.isUp?0:b.isDown?-200:20;a=a.y+a.naturalHeight();
this._target.y=a+b}return this._target}};var q=function(){this._scratchFlockCenter={x:0,y:0};this._settings={avoidance:300,avoidanceDistance:5,flockCentre:1,targetPosition:90};this._flock=[];this._targets=[]};q.__name__=!0;q.moveTowards=function(a,b,c,e){var d=c.x-a.x;c=c.y-a.y;var f=Math.abs(d),g=Math.abs(c),k=Math.abs(f+g);0==k?g=f=0:(f/=k,g/=k);a.veloX+=f*w.sign(d)*e*b;a.veloY+=g*w.sign(c)*e*b};q.calculateFlockCentre=function(a,b){for(var c=0,e=0,d=0;d<a.length;){var f=a[d];++d;c+=f[y._n].x;e+=
f[y._n].y}b.x=c/a.length;b.y=e/a.length};q.moveAwayFromCloseBoids=function(a,b,c,e,d){for(var f=0;f<b.length;){var g=b[f];++f;if(a==g[v._n])break;Math.sqrt(Math.pow(Math.abs(a.x-g[v._n].x),2)+Math.pow(Math.abs(a.y-g[v._n].y),2))<e&&q.moveTowards(a,d,g[v._n],-c)}};q.updateBoid=function(a,b,c,e,d){q.moveTowards(a,b,a.get_target(),d.targetPosition/100);q.moveTowards(a,b,c,d.flockCentre/100);q.moveAwayFromCloseBoids(a,e,d.avoidance/100,d.avoidanceDistance,b);c=a.x;e=a.y;a.x+=a.veloX*b;a.y+=a.veloY*b;
a.angle=w.angle(a.x,a.y,c,e);a.veloX*=.98/b;a.veloY*=.98/b;return a};q.prototype={shouldUpdate:function(a){return a[v._n]?a[y._n]:!1},logic:function(a,b,c){var e=this;this._flock.length=0;this._targets.length=0;n.iterateOnGroup(a.root,function(d){return d[v._n]},function(d){e._flock.push(d);return!1});q.calculateFlockCentre(this._flock,this._scratchFlockCenter);a=b[v._n];b=b[y._n];q.updateBoid(a,60*c,this._scratchFlockCenter,this._flock,this._settings);b.set_x(a.x);b.set_y(a.y);b.angle=a.angle;c=
w.clamp(20*Math.abs(a.veloX),50,90)|0;b.r=c;b.g=c;b.b=c}};var H=function(){this._hasStarted=!1};H.__name__=!0;H.getVal=function(a,b,c,e,d,f){a=-e+c-d;c=Math.abs(a)/500;return f?d+(b?c*a:c*c*c*c*a):d+a};H.prototype={shouldUpdate:function(a){return a[K._n]?a[h._n]:!1},logic:function(a,b,c){a=a.getGroup(function(e){return e[G._n]?e[h._n]:!1})[0];b=b[h._n];null!=a&&(c=a[h._n],b.set_x(H.getVal(a[G._n].isShiftedLeft,!0,600,c.x+c.naturalWidth()/2,b.x,this._hasStarted)),b.set_y(H.getVal(!1,!1,300,c.y+c.naturalHeight()/
2,b.y,this._hasStarted)),this._hasStarted=!0)}};var K=function(){this.name="2"};K.__name__=!0;var u=function(a){this.name="1";this.isLeft=this.isRight=this.isUp=this.isDown=!1;this.isOnGround=!0;this.velocityX=this.velocityY=0;this.acceleration=10;this.type=a};u.__name__=!0;var m=function(){};m.__name__=!0;m.handleWithLeft=function(a,b,c,e){null==e&&(e=0);a.set_x(a.x-(a.right()-c[h._n].left()+e));b.velocityX=0};m.handleWithRight=function(a,b,c,e){null==e&&(e=0);a.set_x(a.x+(c[h._n].right()-a.left()+
e));b.velocityX=0};m.handleWithTop=function(a,b,c,e){null==e&&(e=0);a.set_y(a.y-(a.bottom()-c[h._n].top()+e));b.velocityY=0;b.isOnGround=!0};m.handleWithBottom=function(a,b,c,e){null==e&&(e=0);a.set_y(a.y+(c[h._n].bottom()-a.top()+e));b.velocityY=0};m.prototype={shouldUpdate:function(a){return a[u._n]?a[h._n]:!1},logic:function(a,b,c){var e=this,d=b[u._n];if(0==d.type){var f=b[h._n];d.isUp&&d.isOnGround&&(d.velocityY=-14,d.isOnGround=!1,d.isUp=!1);d.isLeft&&(d.velocityX-=d.acceleration*c);d.isRight&&
(d.velocityX+=d.acceleration*c);10<d.velocityX?d.velocityX=10:-10>d.velocityX&&(d.velocityX=-10);0<d.velocityX?f.scaleX=-1:0>d.velocityX&&(f.scaleX=1);d.isLeft||d.isRight||(d.velocityX=.1>Math.abs(d.velocityX)?0:.8*d.velocityX);f.set_x(f.x+d.velocityX);d.velocityY+=30*c;24<d.velocityY&&(d.velocityY=24);f.set_y(f.y+d.velocityY);0==d.type&&(c=w.clamp(-d.velocityY/20,0,1),c=w.cubeOut(c),f.scaleY=1+.4*c);n.iterateOnGroup(a.root,function(g){return g[u._n]&&g[h._n]?g!=b:!1},function(g){var k=e.checkCollision(f,
g[h._n]),l=g[u._n].type;if(k)switch(l){case 0:e.collidedWithLeft(f,g[h._n])?m.handleWithLeft(f,d,g):e.collidedWithRight(f,g[h._n])?m.handleWithRight(f,d,g):e.collidedWithTop(f,g[h._n])?m.handleWithTop(f,d,g):e.collidedWithBottom(f,g[h._n])&&m.handleWithBottom(f,d,g);break;case 1:e.collidedWithTop(f,g[h._n])&&m.handleWithTop(f,d,g,2);break;case 2:e.collidedWithLeft(f,g[h._n])?m.handleWithLeft(f,d,g):e.collidedWithRight(f,g[h._n])?m.handleWithRight(f,d,g):e.collidedWithTop(f,g[h._n])?m.handleWithTop(f,
d,g):e.collidedWithBottom(f,g[h._n])?m.handleWithBottom(f,d,g):m.handleWithBottom(f,d,g,20)}return!1})}},checkCollision:function(a,b){var c=a.x-a.anchorX,e=a.y-a.anchorY,d=b.x-b.anchorX,f=b.y-b.anchorY;return c<d+b.naturalWidth()&&c+a.naturalWidth()>d&&e<f+b.naturalHeight()?e+a.naturalHeight()>f:!1},collidedWithLeft:function(a,b){return a.right(a.lastX)<=b.left(b.x)?a.right(a.x)>=b.left(b.x):!1},collidedWithRight:function(a,b){return a.left(a.lastX)>=b.right(b.x)?a.left(a.x)<=b.right(b.x):!1},collidedWithTop:function(a,
b){return a.bottom(a.lastY)<=b.top(b.y)?a.bottom(a.y)>=b.top(b.y):!1},collidedWithBottom:function(a,b){return a.top(a.lastY)>=b.bottom(b.y)?a.top(a.y)<=b.bottom(b.y):!1}};var R=function(){this._speedX=this._emotionX=0;this._player=null;this._simplexSpeedX=new p(this.randomIndex());this._simplexEmotion=new p(this.randomIndex())};R.__name__=!0;R.prototype={randomIndex:function(){return Math.floor(999999999*Math.random())},shouldUpdate:function(a){return a[G._n]&&a[h._n]?a[u._n]:!1},logic:function(a,
b,c){null==this._player&&(this._player=b[u._n]);a=this.getEmotion();this._player.velocityX=this.getSpeedX(a);this.getSpeedY(a);this._speedX+=.1*c;this._emotionX+=.1*c},getEmotion:function(){var a=(this._simplexEmotion.get(this._emotionX,0)+1)/2;return.25>=a?z.EXCITED:.5>=a?z.TENDER:.75>=a?z.SCARED:z.SAD},getSpeedX:function(a){switch(a._hx_index){case 0:var b=100;break;case 1:b=40;break;case 2:b=240;break;case 3:b=20}return this._simplexSpeedX.get(this._emotionX,0)*b},getSpeedY:function(a){switch(a._hx_index){case 0:this._player.isDown=
!1;this._player.isUp=!0;break;case 1:this._player.isDown=!1;this._player.isUp=!1;break;case 2:this._player.isDown=!1;this._player.isUp=!1;break;case 3:this._player.isDown=!0,this._player.isUp=!1}}};var z=P["game.controller.PlayerState"]={__ename__:!0,__constructs__:null,EXCITED:{_hx_name:"EXCITED",_hx_index:0,__enum__:"game.controller.PlayerState",toString:J},TENDER:{_hx_name:"TENDER",_hx_index:1,__enum__:"game.controller.PlayerState",toString:J},SCARED:{_hx_name:"SCARED",_hx_index:2,__enum__:"game.controller.PlayerState",
toString:J},SAD:{_hx_name:"SAD",_hx_index:3,__enum__:"game.controller.PlayerState",toString:J}};z.__constructs__=[z.EXCITED,z.TENDER,z.SCARED,z.SAD];var B=function(a,b,c,e){h.call(this);this._simplex=a;this._elapsed=this._yPercent=this._xPercent=this._y=this._x=0;this._width=b;this._height=c;this._tileWidth=e};B.__name__=!0;B.__super__=h;B.prototype=O(h.prototype,{setSimpXY:function(a,b){var c=a%this._tileWidth/this._tileWidth,e=Math.floor(b/this._tileWidth),d=b%this._tileWidth/this._tileWidth;this._x=
Math.floor(a/this._tileWidth);this._xPercent=(c+1)%1;this._y=e;this._yPercent=(d+1)%1;return this},draw:function(a,b){var c,e=0;for(this._elapsed+=.4*b;e*this._tileWidth<this._height+2;){for(c=0;c*this._tileWidth<this._width+2;)this.setColor(a,c-this._x,e-this._y)&&a.fillRect((c-1)*this._tileWidth+this._xPercent*this._tileWidth,(e-1)*this._tileWidth+this._yPercent*this._tileWidth,this._tileWidth,this._tileWidth),++c;++e}},setColor:function(a,b,c){var e=this._simplex().get(b,c);return.98<e?(b=(this._simplex().get(b,
c+this._elapsed)+1)/2,I.setColor(a,255,255,255,b),!0):.95<e?(I.setColor(a,230,230,230,1),!0):!1},naturalWidth:function(){return this._width},naturalHeight:function(){return this._height}});var x=function(){};x.__name__=!0;x.createGradient=function(a,b,c,e,d,f,g,k,l){return{name:a,width:f,height:g,draw:function(t){for(var r=Math.ceil(f/k),F=Math.ceil(g/k),L=0;L<F;)for(var M=L++,U=0;U<r;){var N=U++;I.setColor(t,x.val(b,d,N,M,l),x.val(c,d,N,M,l),x.val(e,d,N,M,l),1);t.fillRect(N*k,M*k,k,k)}}}};x.val=
function(a,b,c,e,d){a-=b;c=d.get(c,e)+.5;return Math.floor(a+b/2+b*c)};var T=function(){this.h=Object.create(null)};T.__name__=!0;var C=function(){};C.__name__=!0;C.__string_rec=function(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;"function"==c&&(a.__name__||a.__ename__)&&(c="object");switch(c){case "function":return"<function>";case "object":if(a.__enum__){var e=P[a.__enum__].__constructs__[a._hx_index];c=e._hx_name;if(e.__params__){b+="\t";var d=[],f=0;for(e=e.__params__;f<
e.length;){var g=e[f];f+=1;d.push(C.__string_rec(a[g],b))}return c+"("+d.join(",")+")"}return c}if(a instanceof Array){c="[";b+="\t";d=0;for(f=a.length;d<f;)e=d++,c+=(0<e?",":"")+C.__string_rec(a[e],b);return c+"]"}try{d=a.toString}catch(k){return"???"}if(null!=d&&d!=Object.toString&&"function"==typeof d&&(c=a.toString(),"[object Object]"!=c))return c;c="{\n";b+="\t";d=null!=a.hasOwnProperty;f=null;for(f in a)d&&!a.hasOwnProperty(f)||"prototype"==f||"__class__"==f||"__super__"==f||"__interfaces__"==
f||"__properties__"==f||(2!=c.length&&(c+=", \n"),c+=b+f+" : "+C.__string_rec(a[f],b));b=b.substring(1);return c+("\n"+b+"}");case "string":return a;default:return String(a)}};String.__name__=!0;Array.__name__=!0;C.__toStr={}.toString;A.TILE_WIDTH=40;h._n="3";y._n="3";E._n="3";p.F2=.5*(Math.sqrt(3)-1);p.G2=(3-Math.sqrt(3))/6;G._n="4";v._n="0";K._n="2";u._n="1";B._n="3";A.main()})({});